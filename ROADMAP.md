# UniPick 项目分析报告与 MVP 路线图

## 📊 项目现状评估

### ✅ 已完成的功能

#### 后端 (FastAPI)
| 模块 | 状态 | 备注 |
|------|------|------|
| 项目架构 | ✅ 完成 | 清晰的模块化结构 (core/api/models/schemas) |
| 数据库连接 | ✅ 完成 | SQLAlchemy 2.0 + asyncpg + PostGIS |
| JWT 认证 | ✅ 完成 | Supabase JWKS 验证，安全可靠 |
| 商品模型 | ✅ 完成 | 支持标题、价格、描述、图片数组、地理位置 |
| 商品创建 API | ✅ 完成 | POST /api/v1/items/，需认证 |
| 商品列表 API | ✅ 完成 | GET /api/v1/items/，支持分页 (skip/limit) |
| CORS 配置 | ✅ 完成 | 开发环境配置完成 |
| 测试数据生成 | ✅ 完成 | seed.py 可生成 20 条测试数据 |
| AI 价格预测占位 | ⚠️ 占位 | /predict-price 仅返回 Coming soon |

#### 前端 (Astro + React)
| 模块 | 状态 | 备注 |
|------|------|------|
| 项目架构 | ✅ 完成 | Astro 5 + React 19 + Tailwind 4 |
| Supabase 客户端 | ✅ 完成 | 类型安全，环境变量配置 |
| 用户注册 | ✅ 完成 | 邮箱验证，密码强度校验 |
| 用户登录 | ✅ 完成 | JWT Token 管理 |
| 忘记密码 | ✅ 完成 | 完整密码重置流程 |
| 用户菜单 | ✅ 完成 | 登录状态显示，登出功能 |
| 商品发布表单 | ✅ 完成 | 图片上传 (最多4张)，拖拽支持 |
| 无限滚动 Feed | ✅ 完成 | TanStack Query，Intersection Observer |
| 类型定义 | ✅ 完成 | 完整的 Database types |

#### 基础设施
| 服务 | 状态 | 备注 |
|------|------|------|
| Supabase Auth | ✅ 就绪 | 用户认证系统 |
| Supabase Storage | ✅ 就绪 | item-images bucket |
| PostgreSQL + PostGIS | ✅ 就绪 | 地理位置功能就绪 |
| profiles 表 | ✅ 存在 | 用户扩展信息表已创建 |

---

## ❌ MVP 缺失功能

### 核心功能缺口
1. **商品详情页** - 点击商品无法查看详情
2. **商品搜索/筛选** - 无关键词搜索、价格区间、分类筛选
3. **分类系统** - 无商品分类体系
4. **用户资料页** - 无法查看/编辑个人资料
5. **我的发布** - 无法查看自己发布的商品
6. **商品状态管理** - 无法标记为已售/下架
7. **收藏功能** - 无法收藏感兴趣的商品
8. **地理位置搜索** - PostGIS 已就绪但未使用
9. **卖家联系** - 无站内信或联系方式展示
10. **商品编辑/删除** - 发布者无法管理自己的商品

### 体验优化缺口
1. **加载骨架屏** - 首次加载体验可优化
2. **错误边界** - 缺少 React Error Boundary
3. **图片懒加载优化** - 已使用 loading="lazy"
4. **响应式设计验证** - 需多设备测试
5. **空状态设计** - 已有基础空状态

### 安全与运维缺口
1. **API 限流** - 无 Rate Limiting
2. **图片上传限制** - 文件大小、类型验证
3. **输入消毒** - 依赖 SQLAlchemy 参数化
4. **单元测试** - 无测试覆盖
5. **日志系统** - 仅开发级日志

---

## 🗓️ MVP 开发路线图 (6 周)

### Phase 1: 核心闭环 (Week 1-2)
**目标**: 让用户能完整发布→查看→管理商品

#### Week 1: 商品详情 + 个人中心
| 任务 | 优先级 | 负责人 | 预估工时 |
|------|--------|--------|----------|
| 商品详情页 (Item Detail) | P0 | Dev | 6h |
| - 图片轮播/画廊 | P0 | Dev | 2h |
| - 卖家信息展示 | P0 | Dev | 2h |
| - 联系卖家按钮 | P0 | Dev | 2h |
| 用户资料页 (Profile) | P0 | Dev | 4h |
| - 编辑头像/昵称 | P1 | Dev | 2h |
| 我的发布页面 | P0 | Dev | 4h |
| - 商品状态标签 (在售/已售) | P1 | Dev | 2h |
| API: 获取单商品详情 | P0 | Dev | 2h |
| API: 获取用户的商品列表 | P0 | Dev | 2h |
| API: 更新/删除商品 | P0 | Dev | 3h |

**交付物**:
- /item/[id] 详情页
- /profile 个人资料页
- /my-listings 我的发布
- 对应后端 API

#### Week 2: 搜索与分类
| 任务 | 优先级 | 负责人 | 预估工时 |
|------|--------|--------|----------|
| 分类系统设计 | P0 | Dev | 3h |
| - 数据库 migration | P0 | Dev | 1h |
| - 前端分类导航 | P0 | Dev | 3h |
| 搜索功能 (关键词) | P0 | Dev | 4h |
| - 后端全文搜索 | P0 | Dev | 3h |
| - 前端搜索框 | P0 | Dev | 2h |
| 价格筛选 | P1 | Dev | 3h |
| 排序功能 (最新/价格) | P1 | Dev | 2h |
| Feed 过滤器组件 | P1 | Dev | 3h |

**交付物**:
- 分类导航栏
- 搜索页面 /search?q=...
- 价格区间筛选
- 排序选项

---

### Phase 2: 交易闭环 (Week 3-4)
**目标**: 连接买家和卖家

#### Week 3: 收藏与联系
| 任务 | 优先级 | 负责人 | 预估工时 |
|------|--------|--------|----------|
| 收藏功能 | P0 | Dev | 4h |
| - 数据库: favorites 表 | P0 | Dev | 1h |
| - API: 收藏/取消收藏 | P0 | Dev | 2h |
| - 前端收藏按钮 | P0 | Dev | 2h |
| 我的收藏页面 | P1 | Dev | 3h |
| 卖家联系方式展示 | P0 | Dev | 3h |
| - 显示邮箱/微信 (可选) | P1 | Dev | 2h |
| - 复制联系方式 | P1 | Dev | 1h |
| 举报商品功能 | P2 | Dev | 3h |

**交付物**:
- 收藏按钮 ❤️
- /favorites 收藏页面
- 商品详情页卖家信息

#### Week 4: 站内消息 (简化版)
| 任务 | 优先级 | 负责人 | 预估工时 |
|------|--------|--------|----------|
| 消息数据模型 | P1 | Dev | 2h |
| - conversations 表 | P1 | Dev | 1h |
| - messages 表 | P1 | Dev | 1h |
| 消息列表 API | P1 | Dev | 3h |
| 发送消息 API | P1 | Dev | 2h |
| 消息中心页面 | P1 | Dev | 4h |
| 未读消息提示 (小红点) | P2 | Dev | 2h |
| 实时消息 (WebSocket/轮询) | P2 | Dev | 4h |

**交付物**:
- /messages 消息中心
- 商品详情页 "联系卖家" 入口
- 未读消息提示

---

### Phase 3: 体验优化 (Week 5)
**目标**: 提升产品完整度

#### Week 5: 地图与优化
| 任务 | 优先级 | 负责人 | 预估工时 |
|------|--------|--------|----------|
| 地图选点 (发布时) | P1 | Dev | 4h |
| - 集成 Leaflet/Google Maps | P1 | Dev | 2h |
| - 地图标记选择位置 | P1 | Dev | 2h |
| 附近商品搜索 (PostGIS) | P1 | Dev | 4h |
| - 按距离筛选 | P1 | Dev | 2h |
| - 地图模式展示 | P2 | Dev | 4h |
| 商品分享功能 | P2 | Dev | 2h |
| 图片压缩/优化 | P2 | Dev | 3h |
| 加载状态优化 | P2 | Dev | 2h |
| 错误页面 (404/500) | P2 | Dev | 2h |

**交付物**:
- 地图位置选择器
- 附近商品筛选
- 分享功能

---

### Phase 4: 发布准备 (Week 6)
**目标**: 准备上线

#### Week 6: 测试与部署
| 任务 | 优先级 | 负责人 | 预估工时 |
|------|--------|--------|----------|
| 单元测试 (后端) | P1 | Tester | 6h |
| 集成测试 (关键流程) | P1 | Tester | 4h |
| 前端 E2E 测试 (Playwright) | P2 | Tester | 6h |
| 性能测试 | P2 | Tester | 3h |
| 安全审计 | P1 | Dev | 3h |
| - SQL 注入检查 | P1 | Dev | 1h |
| - XSS 防护 | P1 | Dev | 1h |
| - 权限检查 | P1 | Dev | 1h |
| 生产环境配置 | P0 | Dev | 3h |
| - 环境变量管理 | P0 | Dev | 1h |
| - CORS 生产配置 | P0 | Dev | 1h |
| 部署文档 | P0 | Documenter | 3h |
| 用户操作手册 | P1 | Documenter | 4h |
| README 完善 | P1 | Documenter | 2h |

**交付物**:
- 测试报告
- 部署文档
- 用户手册
- 生产环境配置

---

## 📋 任务分配建议

### 开发团队配置建议
- **后端开发**: 1人 (Python/FastAPI)
- **前端开发**: 1人 (React/TypeScript)
- **测试**: 1人 (或 Dev 兼任)
- **文档**: 1人 (或 PM 兼任)

### 优先级定义
- **P0 (Critical)**: MVP 必须功能，没有不能上线
- **P1 (High)**: 重要功能，影响核心体验
- **P2 (Medium)**: 锦上添花，可后续迭代

---

## ⚠️ 风险识别

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| Supabase 免费额度限制 | 高 | 中 | 监控用量，准备迁移方案 |
| 图片存储成本 | 中 | 中 | 压缩图片，设置 CDN |
| 地理位置精度问题 | 中 | 低 | 提供手动修正 |
| 并发性能瓶颈 | 中 | 低 | 添加缓存层 (Redis) |
| 消息实时性 | 低 | 中 | 先使用轮询，后续升级 WebSocket |

---

## 🎯 MVP 成功标准

1. **功能完整**: 用户可以完成 注册→发布→浏览→收藏→联系卖家 全流程
2. **性能达标**: 页面加载 < 2s，API 响应 < 500ms
3. **无阻塞 Bug**: P0 级 Bug 清零
4. **文档完整**: 部署文档、API 文档、用户手册齐全

---

## 🚀 后续迭代建议 (Post-MVP)

1. **AI 价格预测** - 完善现有的 placeholder
2. **智能推荐** - 基于浏览历史的推荐算法
3. **多校区支持** - 扩展到其他大学
4. **小程序版本** - 微信/QQ 小程序
5. **信用体系** - 用户评价、交易记录
6. **支付集成** - Venmo/PayPal 快捷支付提示

---

*报告生成时间: 2025-02-13*
*UniPick Project Manager*
